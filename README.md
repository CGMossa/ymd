
<!-- README.md is generated from README.Rmd. Please edit that file -->

# ymd

<!-- badges: start -->

[![R-CMD-check](https://github.com/shrektan/ymd/workflows/R-CMD-check/badge.svg)](https://github.com/shrektan/ymd/actions)
[![CRAN
status](https://www.r-pkg.org/badges/version/ymd)](https://CRAN.R-project.org/package=ymd)
[![Downloads from the RStudio CRAN
mirror](https://cranlogs.r-pkg.org/badges/ymd)](https://cran.r-project.org/package=ymd)
[![Rust Code
Coverage](https://coveralls.io/repos/github/shrektan/ymd/badge.svg?branch=main)](https://coveralls.io/github/shrektan/ymd?branch=main)
<!-- badges: end -->

Convert ‘YMD’ format number or string to Date efficiently, e.g.,
`211225` to `as.Date("2021-12-25")`, using Rust’s standard library. It
also provides helper functions to handle Date, e.g., quick finding the
beginning or end of the given period, adding months to Date, etc.

It’s similar to the `lubridate` package but is much lighter and focuses
only on Date objects.

## Installation

### Binary version (no Rust toolchain required)

The binary package is provided by CRAN. So, if you are on Windows or
macOS, the package can be installed via:

``` r
install.packages("ymd")
```

If you are on Linux, you can try to use the [RSPM (RStudio Package
Manager) repo](https://packagemanager.rstudio.com) provided by RStudio
PBC, via (remember to choose the correct binary repo URL for your
platform):

``` r
install.packages("ymd", repos = "{RSPM-Repo-URL}")
```

In addition, you may download the binary package file generated by
GitHub Action from [the release
page](https://github.com/shrektan/ymd/releases) and install via:

``` r
install.packages("{the-downloaded-binary-pkg-file}", repos = NULL)
```

| artifact                                |     platform |
|:----------------------------------------|-------------:|
| ymd_0.0.1.tgz                           |  macOS Intel |
| ymd_0.0.1.zip                           |      Windows |
| ymd_0.0.1_R\_x86_64-pc-linux-gnu.tar.gz | Ubuntu-18.04 |

### Source version (Rust toolchain required)

If you want to build the dev version from source, you’ll need the Rust
toolchain, which can be installed following [the instructions from the
Rust book](https://doc.rust-lang.org/book/ch01-01-installation.html).

After that, you can build the package via:

``` r
remotes::install_github("ymd")
```

## Use Cases and Benchmarks

``` r
print_bmk <- function(x) {
  x[[1]] <- format(x[[1]])
  x[[5]] <- format(x[[5]])
  rnd <- \(v) if (is.numeric(v)) round(v, 1) else v
  x[, 1:8] |>
    lapply(rnd) |>
    as.data.frame() |>
    knitr::kable() |>
    print()
}
run_bmk <- function(..., time_unit = "us") {
  bench::mark(..., time_unit = time_unit) |> print_bmk()
}
```

### ymd

``` r
x <- c("210101", "21/02/03", "89-1-03", "1989.03.05", "01 02 03")
x <- rep(x, 100)
run_bmk(
  ymd::ymd(x),
  lubridate::ymd(x)
)
```

| expression        |    min | median | itr.sec | mem_alloc | gc.sec | n_itr | n_gc |
|:------------------|-------:|-------:|--------:|:----------|-------:|------:|-----:|
| ymd::ymd(x)       |   32.0 |   32.8 | 30026.1 | 814.5KB   |    0.0 | 10000 |    0 |
| lubridate::ymd(x) | 1366.2 | 1406.5 |   707.6 | 8.71MB    |   15.4 |   322 |    7 |

``` r

x <- c(210101, 210224, 211231, 19890103)
x <- rep(x, 100)
run_bmk(
  ymd::ymd(x),
  lubridate::ymd(x)
)
```

| expression        |    min | median | itr.sec | mem_alloc | gc.sec | n_itr | n_gc |
|:------------------|-------:|-------:|--------:|:----------|-------:|------:|-----:|
| ymd::ymd(x)       |   13.0 |   13.7 | 72222.3 | 3.17KB    |    0.0 | 10000 |    0 |
| lubridate::ymd(x) | 1699.1 | 1723.8 |   572.2 | 362.21KB  |   17.5 |   262 |    8 |

``` r

x <- c("2021-01-01", "2022-12-31", "1995-03-22")
x <- rep(x, 100)
run_bmk(
  ymd::ymd(x),
  lubridate::ymd(x),
  as.Date(x)
)
```

| expression        |   min | median | itr.sec | mem_alloc | gc.sec | n_itr | n_gc |
|:------------------|------:|-------:|--------:|:----------|-------:|------:|-----:|
| ymd::ymd(x)       |  24.3 |   24.9 | 39899.1 | 2.39KB    |    0.0 | 10000 |    0 |
| lubridate::ymd(x) | 789.7 |  802.7 |  1220.1 | 193.52KB  |   17.2 |   566 |    8 |
| as.Date(x)        | 642.0 |  648.3 |  1541.5 | 87.54KB   |    2.0 |   760 |    1 |

``` r

x <- ymd::ymd(210515) + 1:100
run_bmk(
  ymd::eop$tm(x),
  lubridate::ceiling_date(x, "month") - 1
)
```

| expression                              |  min | median |  itr.sec | mem_alloc | gc.sec | n_itr | n_gc |
|:----------------------------------------|-----:|-------:|---------:|:----------|-------:|------:|-----:|
| ymd::eop\$tm(x)                         |  6.1 |    6.6 | 146488.7 | 19.3KB    |   14.7 |  9999 |    1 |
| lubridate::ceiling_date(x, “month”) - 1 | 33.0 |   34.4 |  28447.0 | 155.4KB   |   28.5 |  9990 |   10 |

### edate

``` r
`%m+%` <- lubridate::`%m+%`
x <- ymd::ymd(c(200115, 200131, 200229, 200331, 200401))
x <- rep(x, 100)
run_bmk(
  ymd::edate(x, 2),
  x %m+% months(2)
)
```

| expression       |   min | median | itr.sec | mem_alloc | gc.sec | n_itr | n_gc |
|:-----------------|------:|-------:|--------:|:----------|-------:|------:|-----:|
| ymd::edate(x, 2) |  14.1 |   15.0 | 65970.1 | 6.2KB     |    0.0 | 10000 |    0 |
| x %m+% months(2) | 314.2 |  334.8 |  2927.4 | 459.8KB   |   21.4 |  1367 |   10 |

``` r
run_bmk(
  ymd::edate(x, -12),
  x %m+% months(-12)
)
```

| expression         |   min | median | itr.sec | mem_alloc | gc.sec | n_itr | n_gc |
|:-------------------|------:|-------:|--------:|:----------|-------:|------:|-----:|
| ymd::edate(x, -12) |  14.3 |   15.2 | 64155.7 | 3.95KB    |    6.4 |  9999 |    1 |
| x %m+% months(-12) | 655.8 |  703.6 |  1390.7 | 286.83KB  |   28.3 |   639 |   13 |

### Extract Date Part

``` r
# tweak from https://github.com/Rdatatable/data.table/pull/5300
set.seed(373L)
x <- as.Date(data.table::as.IDate(sample(seq(-25000, 45000), 1e6, TRUE)))

run_bmk(
  data.table::year(x),
  lubridate::year(x),
  funchir::quick_year(x),
  ymd::year(x)
)
#> Warning: Some expressions had a GC in every iteration; so filtering is
#> disabled.
```

| expression             |     min |  median | itr.sec | mem_alloc | gc.sec | n_itr | n_gc |
|:-----------------------|--------:|--------:|--------:|:----------|-------:|------:|-----:|
| data.table::year(x)    | 84822.2 | 86741.7 |    10.5 | 41.97MB   |   14.0 |     6 |    8 |
| lubridate::year(x)     | 83662.3 | 86033.5 |    10.7 | 45.78MB   |   16.0 |     6 |    9 |
| funchir::quick_year(x) | 28298.0 | 28873.1 |    29.2 | 26.76MB   |    9.1 |    16 |    5 |
| ymd::year(x)           |  8191.1 |  9046.2 |   109.4 | 3.82MB    |    4.0 |    55 |    2 |

``` r
run_bmk(
  data.table::month(x),
  lubridate::month(x),
  ymd::month(x)
)
#> Warning: Some expressions had a GC in every iteration; so filtering is
#> disabled.
```

| expression           |      min |   median | itr.sec | mem_alloc | gc.sec | n_itr | n_gc |
|:---------------------|---------:|---------:|--------:|:----------|-------:|------:|-----:|
| data.table::month(x) |  84483.4 |  88151.1 |    10.8 | 41.97MB   |   12.6 |     6 |    7 |
| lubridate::month(x)  | 104431.1 | 105533.3 |     9.4 | 83.92MB   |   17.0 |     5 |    9 |
| ymd::month(x)        |   9634.5 |   9902.1 |    98.2 | 3.82MB    |    9.8 |    50 |    5 |

``` r
run_bmk(
  data.table::quarter(x),
  lubridate::quarter(x),
  ymd::quarter(x)
)
#> Warning: Some expressions had a GC in every iteration; so filtering is
#> disabled.
```

| expression             |      min |   median | itr.sec | mem_alloc | gc.sec | n_itr | n_gc |
|:-----------------------|---------:|---------:|--------:|:----------|-------:|------:|-----:|
| data.table::quarter(x) |  86099.9 |  87908.3 |    10.8 | 41.97MB   |   10.8 |     6 |    6 |
| lubridate::quarter(x)  | 123584.4 | 126069.6 |     7.7 | 99.21MB   |   17.2 |     4 |    9 |
| ymd::quarter(x)        |  15602.1 |  16353.4 |    60.3 | 3.82MB    |    1.9 |    31 |    1 |

``` r
run_bmk(
  data.table::yday(x),
  lubridate::yday(x),
  funchir::quick_yday(x),
  ymd::yday(x)
)
```

| expression             |     min |  median | itr.sec | mem_alloc | gc.sec | n_itr | n_gc |
|:-----------------------|--------:|--------:|--------:|:----------|-------:|------:|-----:|
| data.table::yday(x)    | 84419.3 | 84695.2 |    11.8 | 41.97MB   |   35.4 |     2 |    6 |
| lubridate::yday(x)     | 83464.2 | 83464.2 |    12.0 | 45.78MB   |  107.8 |     1 |    9 |
| funchir::quick_yday(x) | 22463.8 | 22803.7 |    43.6 | 19.08MB   |   26.8 |    13 |    8 |
| ymd::yday(x)           |  9969.6 | 10643.1 |    92.6 | 3.82MB    |    2.1 |    45 |    1 |

``` r
run_bmk(
  data.table::mday(x),
  lubridate::mday(x),
  funchir::quick_mday(x),
  ymd::mday(x)
)
```

| expression             |     min |  median | itr.sec | mem_alloc | gc.sec | n_itr | n_gc |
|:-----------------------|--------:|--------:|--------:|:----------|-------:|------:|-----:|
| data.table::mday(x)    | 81453.9 | 82436.4 |    12.1 | 38.15MB   |   30.3 |     2 |    5 |
| lubridate::mday(x)     | 81998.4 | 81998.4 |    12.2 | 38.15MB   |   61.0 |     1 |    5 |
| funchir::quick_mday(x) |  8904.6 |  9018.1 |   107.7 | 15.28MB   |   18.0 |    36 |    6 |
| ymd::mday(x)           |  9152.0 |  9851.4 |   103.1 | 3.82MB    |    4.2 |    49 |    2 |

``` r
run_bmk(
  data.table::wday(x),
  lubridate::wday(x),
  ymd::wday(x)
)
```

| expression          |     min |  median | itr.sec | mem_alloc | gc.sec | n_itr | n_gc |
|:--------------------|--------:|--------:|--------:|:----------|-------:|------:|-----:|
| data.table::wday(x) | 10279.8 | 10405.0 |    95.4 | 3.82MB    |    6.5 |    44 |    3 |
| lubridate::wday(x)  | 83288.9 | 84152.7 |    11.9 | 45.78MB   |   15.8 |     3 |    4 |
| ymd::wday(x)        |  9094.3 | 10093.9 |   100.7 | 3.82MB    |    4.2 |    48 |    2 |

``` r
run_bmk(
  data.table::isoweek(x),
  lubridate::isoweek(x),
  ymd::isoweek(x)
)
#> Warning: Some expressions had a GC in every iteration; so filtering is
#> disabled.
```

| expression             |       min |    median | itr.sec | mem_alloc | gc.sec | n_itr | n_gc |
|:-----------------------|----------:|----------:|--------:|:----------|-------:|------:|-----:|
| data.table::isoweek(x) | 2679516.3 | 2679516.3 |     0.4 | 225.14MB  |    1.5 |     1 |    4 |
| lubridate::isoweek(x)  |  263894.9 |  270689.4 |     3.7 | 248MB     |   16.6 |     2 |    9 |
| ymd::isoweek(x)        |   10592.1 |   11358.2 |    88.3 | 3.82MB    |    3.9 |    45 |    2 |

## Session Info

``` r
xfun::session_info()
#> R version 4.2.1 (2022-06-23)
#> Platform: aarch64-apple-darwin20 (64-bit)
#> Running under: macOS Ventura 13.4.1
#> 
#> Locale: en_US.UTF-8 / en_US.UTF-8 / en_US.UTF-8 / C / en_US.UTF-8 / en_US.UTF-8
#> 
#> Package version:
#>   base64enc_0.1.3   bench_1.1.3       bslib_0.5.1       cachem_1.0.8     
#>   cli_3.6.1         compiler_4.2.1    cpp11_0.4.6       data.table_1.14.8
#>   digest_0.6.33     ellipsis_0.3.2    evaluate_0.21     fansi_1.0.4      
#>   fastmap_1.1.1     fontawesome_0.5.2 fs_1.6.3          funchir_0.2.2    
#>   generics_0.1.3    glue_1.6.2        graphics_4.2.1    grDevices_4.2.1  
#>   highr_0.10        htmltools_0.5.6   jquerylib_0.1.4   jsonlite_1.8.7   
#>   knitr_1.43        lifecycle_1.0.3   lubridate_1.9.2   magrittr_2.0.3   
#>   memoise_2.0.1     methods_4.2.1     mime_0.12         pillar_1.9.0     
#>   pkgconfig_2.0.3   profmem_0.6.0     R6_2.5.1          rappdirs_0.3.3   
#>   rlang_1.1.1       rmarkdown_2.24    sass_0.4.7        stats_4.2.1      
#>   stringi_1.7.12    stringr_1.5.0     tibble_3.2.1      timechange_0.2.0 
#>   tinytex_0.46      tools_4.2.1       utf8_1.2.3        utils_4.2.1      
#>   vctrs_0.6.3       xfun_0.40         yaml_2.3.7        ymd_0.0.5
```
